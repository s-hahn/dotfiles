#!/bin/bash

DOTFILES_ROOT=$(pwd)

# symlink dotfiles into home directory
install_dotfiles () {

  local overwrite_all=false backup_all=false skip_all=false

  for src in $(find "$DOTFILES_ROOT/" -maxdepth 2 -name '*.symlink')
  do
    dst="$HOME/$(basename "${src%.*}")"
    ln -sf "$src" "$dst"
  done
}

install_dotfiles
touch $DOTFILES_ROOT/.spacemacs.d.symlink/custom.el

# setup submodules of dotfiles
cd $DOTFILES_ROOT
git submodule init
git submodule sync
git submodule update

# setup pyenv and submodules
ln -sf $DOTFILES_ROOT/.pyenv ~/.pyenv
cd $DOTFILES_ROOT/.pyenv
git submodule init
git submodule sync
git submodule update

# setup oh-my-zsh and submodules
cd $DOTFILES_ROOT
ln -sf $DOTFILES_ROOT/z/z.sh ~/z.sh
ln -sf $DOTFILES_ROOT/.oh-my-zsh ~/.oh-my-zsh
cd $DOTFILES_ROOT/.oh-my-zsh
git submodule init
git submodule sync
git submodule update

# setup pure theme for zsh
cd ~/.oh-my-zsh/custom/
git clone https://github.com/sindresorhus/pure
mv pure/pure.zsh pure.zsh-theme
mv pure/async.zsh async.zsh

# setup spacemacs and submodules
git clone https://github.com/syl20bnr/spacemacs ~/.emacs.d
ln -sf $DOTFILES_ROOT/.spacemacs.d.symlink/snippets/* ~/.emacs.d/private/snippets
cd ~/.emacs.d
git submodule init
git submodule sync
git submodule update

# setup terminal theme
cd $DOTFILES_ROOT
bash terminal-theme.sh

# symlink config folder
ln -s $DOTFILES_ROOT/.config/* ~/.config

# symlink bin folder
mkdir ~/bin
ln -s $DOTFILES_ROOT/bin/* ~/bin

# symlink ranger
ln -s $DOTFILES_ROOT/ranger/ranger.py ~/bin/ranger
